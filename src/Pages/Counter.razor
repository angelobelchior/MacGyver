@using ZXing;
@using ZXing.Common;
@using ZXing.SkiaSharp;

@using Microsoft.FluentUI.AspNetCore.Components 

@page "/counter"

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

<FluentButton Appearance="Appearance.Outline" @onclick="IncrementCount">Click Me</FluentButton>

<img src="@image" />

@code {

    string image = string.Empty;

    private void IncrementCount()
    {
        var data = "Hello, QR Code!";

        var barcodeWriter = new BarcodeWriter
        {
            Format = BarcodeFormat.QR_CODE,
            Options = new ZXing.Common.EncodingOptions
            {
                Height = 300,
                Width = 300
            }
        };
        using var bitmap = barcodeWriter.Write(data);
        using var memoryStream = new MemoryStream();
        bitmap.Encode(memoryStream, SkiaSharp.SKEncodedImageFormat.Png, 100);
        var byteImage = memoryStream.ToArray();
        var base64String = Convert.ToBase64String(byteImage);
        image = $"data:image/png;base64,{base64String}";
    }
}